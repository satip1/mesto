(()=>{"use strict";var e={508:(e,t,n)=>{e.exports=n.p+"1c5c9b10fc4847fec93b.png"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.p="",(()=>{var e={formSelector:".popup__form",inputSelector:".popup__input",errorSelector:".popup__error",submitButtonSelector:".popup__btn-save",inactiveButtonClass:"popup__btn-save_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__error_active"},t=n(508);function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=t.name,s=t.link,c=t.like,u=t.myLike,l=t.idAftorFoto,f=t.idUser,h=t.idPicture;this._message=a,this._src=s,this._count=c,this._myLike=u,this._idAftorFoto=l,this._idUser=f,this._idPicture=h,this._template=n,this._handleCardClick=r,this._handleToggleLikeCard=o,this._handleDeleteCard=i}var n,o;return n=e,(o=[{key:"_getTemplate",value:function(){this._element=document.querySelector(this._template).content.querySelector(".foto__card").cloneNode(!0),this._text=this._element.querySelector(".foto__text"),this._trash=this._element.querySelector(".foto__trash"),this._image=this._element.querySelector(".foto__image"),this._like=this._element.querySelector(".foto__like"),this._number=this._element.querySelector(".foto__count"),this._mark=this._element.querySelector(".foto__mark")}},{key:"_handleOpenFullImage",value:function(e){e.stopPropagation(),this._handleCardClick(this)}},{key:"_setEventListeners",value:function(){var e=this;this._idUser===this._idAftorFoto?this._trash.addEventListener("click",(function(){e._handleDeleteCard(e)})):this._trash.classList.add("foto__trash_disabled"),this._like.addEventListener("click",(function(){e._handleToggleLikeCard(e)})),this._image.addEventListener("click",(function(t){e._handleOpenFullImage(t)}))}},{key:"deleteCard",value:function(){this._element.remove()}},{key:"createCard",value:function(){var e=this;return this._getTemplate(),this._text.textContent=this._message,this._number.textContent=this._count,this._image.src=this._src,this._image.alt=this._message,this._myLike&&this._like.classList.toggle("foto__like_plus"),this._image.onerror=function(){e._message="Ошибка загрузки ".concat(e._message,". По указанному адресу файл недоступен"),e._src=t,e._image.src=t,e._text.textContent=e._message,e._number.textContent="0",e._image.alt=e._message,e._idUser="Error",e._idAftorFoto="Error",e._trash.classList.remove("foto__trash_disabled"),e._mark.classList.remove("foto__mark"),e._mark.classList.add("foto__trash_disabled"),e._trash.classList.add("foto__trash_disabled")},this._setEventListeners(),this._element}},{key:"getLinkMessage",value:function(){return{link:this._src,message:this._message}}},{key:"getCardIdPicture",value:function(){return this._idPicture}},{key:"getStateLike",value:function(){return this._like.classList.contains("foto__like_plus")}},{key:"setLockLike",value:function(){this._like.disabled=!0}},{key:"setUnLockLike",value:function(){this._like.disabled=!1}},{key:"changeStateLike",value:function(e){this._number.textContent=e,this._like.classList.toggle("foto__like_plus")}}])&&r(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),e}();function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inactiveButtonClass=t.inactiveButtonClass,this._form=document.querySelector(".".concat(n)),this._btnSave=this._form.querySelector(this._submitButtonSelector),this._inputFields=this._form.querySelectorAll(this._inputSelector)}var t,n;return t=e,(n=[{key:"_hiddeError",value:function(e,t){t.textContent="",t.classList.remove(this._errorClass),e.classList.remove(this._inputErrorClass)}},{key:"_showError",value:function(e,t,n){t.textContent=e.validationMessage,t.classList.add(this._errorClass),e.classList.add(this._inputErrorClass)}},{key:"_checkBtnSaveValid",value:function(){this._form.checkValidity()?(this._btnSave.removeAttribute("disabled"),this._btnSave.classList.remove(this._inactiveButtonClass)):(this._btnSave.setAttribute("disabled",""),this._btnSave.classList.add(this._inactiveButtonClass))}},{key:"resetValidation",value:function(){var e=this;this._checkBtnSaveValid(),this._inputFields.forEach((function(t){var n=e._form.querySelector(".".concat(t.id,"-error"));e._hiddeError(t,n)}))}},{key:"_checkInputValid",value:function(e){var t=this._form.querySelector(".".concat(e.id,"-error"));e.validity.valid?this._hiddeError(e,t):this._showError(e,t),this._checkBtnSaveValid()}},{key:"enableValidation",value:function(){var e=this;this._inputFields.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValid(t)}))}))}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selectorPopup=t,this._popup=document.querySelector(this._selectorPopup),this._handleEscClose=this._popupEscClose.bind(this)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),window.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),window.removeEventListener("keydown",this._handleEscClose)}},{key:"_popupEscClose",value:function(e){"Escape"===e.key&&(e.preventDefault(),this.close())}},{key:"setEventListeners",value:function(){var e=this;this._popup.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__btn-close"))&&e.close()}))}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=h(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},f.apply(this,arguments)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function _(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(r);if(o){var n=v(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return _(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(r=i.call(this,e))._evtSubmit=t.bind(p(r)),r._selectorForm=n.formSelector,r._selectorInput=n.inputSelector,r._submitButtonSelector=n.submitButtonSelector,r._inactiveButtonClass=n.inactiveButtonClass,r._form=r._popup.querySelector(r._selectorForm),r._submit=r._popup.querySelector(r._submitButtonSelector),r._formInputs=r._popup.querySelectorAll(r._selectorInput),r}return t=a,(n=[{key:"getInputValues",value:function(){var e=this;return this._formValues={},this._formInputs.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"close",value:function(){this._form.reset(),f(v(a.prototype),"close",this).call(this)}},{key:"setData",value:function(e){this._element=e}},{key:"getData",value:function(){return this._element}},{key:"setEventListeners",value:function(){var e=this;f(v(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){e._evtSubmit(t,e)}))}},{key:"setTextBtnSave",value:function(e){e?(this._submit.textContent="Сохранение ...",this._submit.disabled=!0):(this._submit.textContent="Сохранить",this._submit.disabled=!1)}}])&&l(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(c);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=g(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},k.apply(this,arguments)}function g(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}function S(e,t){return S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},S(e,t)}function w(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=C(r);if(o){var n=C(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).fullPicter=t._popup.querySelector(".fullimage__image"),t.fullText=t._popup.querySelector(".fullimage__text"),t}return t=a,(n=[{key:"open",value:function(e,t){this.fullPicter.src=e,this.fullPicter.alt=t,this.fullText.textContent=t,k(C(a.prototype),"open",this).call(this)}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(c);function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var P=function(){function e(t,n){var r=t.items,o=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._items=r,this._renderer=o,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"addItem",value:function(e,t){"append"==e?this._container.append(t):this._container.prepend(t)}},{key:"renderItems",value:function(){var e=this;this._items.forEach((function(t){var n=e._renderer(t);e.addItem("append",n)}))}}])&&E(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var j=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selectName=t,this._selectInfo=n,this._selectAvatar=r,this._userName=document.querySelector(this._selectName),this._userInfo=document.querySelector(this._selectInfo),this._userAvatar=document.querySelector(this._selectAvatar)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){var e={};return e.name=this._userName.textContent,e.info=this._userInfo.textContent,e}},{key:"getUserId",value:function(){return this._userId}},{key:"setUserId",value:function(e){this._userId=e}},{key:"setUserInfo",value:function(e,t){this._userName.textContent=e,this._userInfo.textContent=t}},{key:"setUserAvatar",value:function(e){this._userAvatar.src=e}}])&&O(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I,U=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=t,this._header=n}var t,n;return t=e,(n=[{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}},{key:"getUserData",value:function(){return fetch("".concat(this._baseUrl,"/users/me"),this._header).then(this._checkResponse)}},{key:"getInitCard",value:function(){return fetch("".concat(this._baseUrl,"/cards"),this._header).then(this._checkResponse)}},{key:"setProfileSave",value:function(e,t){var n={method:"PATCH",headers:this._header.headers,body:JSON.stringify({name:e,about:t})};return fetch("".concat(this._baseUrl,"/users/me"),n).then(this._checkResponse)}},{key:"recordNewCard",value:function(e,t){var n={method:"POST",headers:this._header.headers,body:JSON.stringify({name:e,link:t})};return fetch("".concat(this._baseUrl,"/cards"),n).then(this._checkResponse)}},{key:"deleteCurrentCard",value:function(e){var t={method:"DELETE",headers:this._header.headers};return fetch("".concat(this._baseUrl,"/cards/").concat(e),t).then(this._checkResponse)}},{key:"recordNewAvatar",value:function(e){var t={method:"PATCH",headers:this._header.headers,body:JSON.stringify({avatar:e})};return fetch("".concat(this._baseUrl,"/users/me/avatar"),t).then(this._checkResponse)}},{key:"addLike",value:function(e){var t={method:"PUT",headers:this._header.headers};return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),t).then(this._checkResponse)}},{key:"deletLike",value:function(e){var t={method:"DELETE",headers:this._header.headers};return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),t).then(this._checkResponse)}}])&&x(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),T=document.querySelector(".popup__input_user"),q=document.querySelector(".popup__input_about"),B=".tempcart",R={},A={},D=new j(".profile__title",".profile__text",".profile__avatar"),V=new U("https://mesto.nomoreparties.co/v1/cohort-39",{headers:{authorization:"58a2884c-c32e-4a00-89a4-083f16aca954","Content-Type":"application/json"}});function F(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B,n=new o(e,t,N,J,M);return n.createCard()}function N(e){var t=e.getLinkMessage();A.fullimage.open(t.link,t.message)}function J(e){e.setLockLike(),e.getStateLike()?V.deletLike(e._idPicture).then((function(t){e.changeStateLike(t.likes.length)})).catch((function(e){console.log(e)})).finally((function(){e.setUnLockLike()})):V.addLike(e._idPicture).then((function(t){e.changeStateLike(t.likes.length)})).catch((function(e){console.log(e)})).finally((function(){e.setUnLockLike()}))}function M(e){A.delCard.setData(e),A.delCard.open()}document.querySelector(".profile__btn-avatar").addEventListener("click",(function(){R.editavatar__form.resetValidation(),A.editavatar.open()})),document.querySelector(".profile__btn-edit").addEventListener("click",(function(){R.editprofile__form.resetValidation();var e=D.getUserInfo(),t=e.name,n=e.info;T.value=t,q.value=n,A.editprofile.open()})),document.querySelector(".profile__btn-add").addEventListener("click",(function(){R.addcard__form.resetValidation(),A.addcard.open()})),A.editprofile=new y(".editprofile",(function(e,t){e.preventDefault(),t.setTextBtnSave(!0);var n=t.getInputValues(),r=n.edit__name,o=n.edit__about;V.setProfileSave(r,o).then((function(e){D.setUserInfo(e.name,e.about),t.close()})).catch((function(e){console.error("Ошибка загрузки изображения")})).finally((function(){t.setTextBtnSave(!1)}))}),e),A.editprofile.setEventListeners(),A.addcard=new y(".addcard",(function(e,t){e.preventDefault(),t.setTextBtnSave(!0);var n=D.getUserId(),r=t.getInputValues(),o=r.addcard__name,i=r.addcard__about;V.recordNewCard(o,i).then((function(e){return e})).then((function(e){var r={name:o.trim(),link:i.trim(),like:0,myLike:!1,idAftorFoto:n,idUser:n,idPicture:e._id};I.addItem("prepend",F(r,B)),t.close()})).catch((function(e){console.error("Ошибка загрузки изображения")})).finally((function(){t.setTextBtnSave(!1)}))}),e),A.addcard.setEventListeners(),A.editavatar=new y(".editavatar",(function(e,t){e.preventDefault();var n=t.getInputValues().editavatar__about;t.setTextBtnSave(!0),V.recordNewAvatar(n).then((function(e){D.setUserAvatar(e.avatar),t.close()})).catch((function(e){console.log(e)})).finally((function(){t.setTextBtnSave(!1)}))}),e),A.editavatar.setEventListeners(),A.delCard=new y(".delCard",(function(e,t){e.preventDefault();var n=t.getData(),r=n.getCardIdPicture();V.deleteCurrentCard(r).then((function(e){n.deleteCard(),t.close()})).catch((function(e){return console.error("Ошибка удаления на сервере")}))}),e),A.delCard.setEventListeners(),A.fullimage=new L(".fullimage"),A.fullimage.setEventListeners(),document.querySelectorAll(".popup__form").forEach((function(t){R[t.classList[1]]=new a(e,t.classList[1]),R[t.classList[1]].enableValidation()})),Promise.all([V.getUserData(),V.getInitCard()]).then((function(e){!function(e){D.setUserInfo(e.name,e.about),D.setUserId(e._id),D.setUserAvatar(e.avatar)}(e[0]),function(e){var t,n=D.getUserId(),r="";t=e.map((function(e){return r=!!(r=e.likes.find((function(e,t){return e._id==n}))),{name:e.name,link:e.link,like:e.likes.length,myLike:r,idAftorFoto:e.owner._id,idUser:n,idPicture:e._id}})),(I=new P({items:t,renderer:F},".foto")).renderItems()}(e[1])})).catch((function(e){return console.log("Что-то пошло нет так")}))})()})();